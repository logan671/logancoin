# 휘릭휘릭메모장 (앞으로 할 일만)

## 복붙용 명령어

### 1) personal 서버 접속
```bash
ssh -i ~/.ssh/keys/lightsail-default.pem ubuntu@43.203.122.192
```

### 2) signer 실거래 키 주입 + real signer 재시작
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX
pkill -f 'signer/server.js' || true
nohup env SIGNER_PORT=8788 SIGNER_API_TOKEN='' SIGNER_HIRO_API_BASE='https://api.hiro.so' SIGNER_PRIVATE_KEY='여기에_실제_거래프라이빗키' /usr/bin/node signer/server.js > /tmp/stx_real_signer.log 2>&1 &
curl -s http://127.0.0.1:8788/health
```

### 3) bot 재시작 (real signer 연결 상태)
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX
pkill -f 'python3 -m bot.app' || true
nohup /usr/bin/python3 -m bot.app > /tmp/stx_bot.log 2>&1 &
```

### 4) 상태 확인
```bash
tail -n 80 /tmp/stx_real_signer.log
tail -n 80 /tmp/stx_bot.log
sqlite3 ~/claudecode/ProjectL\ -STX/stSTX/bot/bot.sqlite3 "select id,event_time_utc,event_type,status,error_message from alerts order by id desc limit 20;"
```

### 5) 봇 전용 STX 키 새로 생성 (권장)
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX/signer
mkdir -p ~/.stx-bot-secrets && chmod 700 ~/.stx-bot-secrets
node -e "const fs=require('fs'); const {randomPrivateKey,getAddressFromPrivateKey,TransactionVersion}=require('@stacks/transactions'); const pk=randomPrivateKey(); const p=pk.startsWith('0x')?pk.slice(2):pk; fs.writeFileSync(process.env.HOME+'/.stx-bot-secrets/signer_private_key', p+'\\n', {mode:0o600}); const addr=getAddressFromPrivateKey(p, TransactionVersion.Mainnet); console.log('FUND_THIS_ADDRESS='+addr);"
```

### 6) signer를 새 키로 재시작
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX
pkill -f 'signer/server.js' || true
nohup env SIGNER_PORT=8788 SIGNER_API_TOKEN='' SIGNER_HIRO_API_BASE='https://api.hiro.so' SIGNER_PRIVATE_KEY=\"$(cat ~/.stx-bot-secrets/signer_private_key)\" /usr/bin/node signer/server.js > /tmp/stx_real_signer.log 2>&1 &
curl -s http://127.0.0.1:8788/health
```

### 7) (선택) 내 니모닉으로 private key 파생해서 signer 키 파일 저장
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX/signer
npm install @stacks/wallet-sdk --silent
read -s -p '니모닉 24단어 입력: ' MNEMONIC; echo
MNEMONIC="$MNEMONIC" node -e "const {generateWallet,getStxAddress}=require('@stacks/wallet-sdk'); (async()=>{const w=await generateWallet({secretKey:process.env.MNEMONIC,password:'local-only-pass'}); const a=w.accounts[0]; const pk=(a.stxPrivateKey||'').replace(/^0x/,''); const addr=getStxAddress({account:a,transactionVersion:1}); require('fs').mkdirSync(process.env.HOME+'/.stx-bot-secrets',{recursive:true}); require('fs').writeFileSync(process.env.HOME+'/.stx-bot-secrets/signer_private_key',pk+'\\n',{mode:0o600}); console.log('DERIVED_ADDRESS='+addr);})();"
unset MNEMONIC
```

### 8) 리밸런싱 운영 룰 (수익 보호형)
```bash
# 강제 리밸런싱 금지
# 기대순이익(rebalance_net) <= 0 이면 실행 금지
# 목표비중 STX 65% / stSTX 35%
# 이탈허용 ±20%p
# 6시간마다 체크, 1회 $100~$200, 하루 최대 2회
```

### 9) 리밸런싱 활성화용 주소 설정
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX
grep '^TRADING_ADDRESS=' bot/.env
# 비어있으면 아래처럼 실제 signer 지갑 주소로 넣기
sed -i 's/^TRADING_ADDRESS=.*/TRADING_ADDRESS=여기에_실제_SIGNER_STX주소/' bot/.env
```

### 10) 테스트: 1 STX를 stSTX로 1회 주문 + 텔레그램 알림 확인
```bash
cd ~/claudecode/ProjectL\ -STX/stSTX
STX_USD_FALLBACK=0.24925 STSTX_USD_FALLBACK=0.22000 ENTRY_THRESHOLD_PCT=0.0001 MIN_LIQUIDITY_USD=0 EXECUTION_BUFFER_PCT=0 DEX_FEE_PCT=0 MAX_ORDER_USD=0.24925 REBALANCE_ENABLED=false python3 -m bot.app --once
sqlite3 bot/bot.sqlite3 "select id,event_time_utc,event_type,status,error_message from alerts order by id desc limit 5;"
sqlite3 bot/bot.sqlite3 "select id,side,status,reason,txid,event_time_utc from orders order by id desc limit 5;"
```
