# ProjectK - polycopyman PRD

## 1. 목표
- Polymarket 소스 지갑 거래를 follower 지갑이 자동으로 복제 실행하는 시스템 구축
- 운영 단위는 `source_wallet : follower_wallet = 1:1` 고정 페어
- 초기부터 `live` 소액 자동 실행으로 시작

## 2. 범위
### 포함
- 소스 지갑 온체인 이벤트 실시간 감지
- 거래 신호 정규화(매수/매도, 방향, 규모)
- follower 지갑 자동 주문 실행
- 리스크 가드(슬리피지/실패횟수/가스 잔고)
- 텔레그램 알림
- Web UI 대시보드(지갑별 PnL/상태 추적)

### 제외(초기)
- 전략 최적화 엔진(알파 모델)
- 멀티체인 확장
- 고급 포트폴리오 리밸런싱

## 3. 운영 정책(확정)
- 페어 구조: 소스 1개당 follower 1개
- follower 예산: `100~1000 USD` 랜덤
- follower 가스: 초기 `3 MATIC` 충전
- 가스 알림 임계값: `0.5 MATIC 이하`
- 주문 사이징: 소스 지갑 대비 비율 복제
- 최소 주문: 시장/토큰별 `min_order_size` 이상으로 보정
- 실행 모드: `live`
- 청산 규칙: 소스 매도 시 follower 즉시 매도
- 슬리피지 상한: `3%`
- 연속 실패 허용: `3회` (초과 시 자동 중지)
- 비상정지 조건: `RPC 오류 연속`, `체결 실패 연속`, `잔고 부족`

## 4. 핵심 기능 요구사항
### 4.1 페어 관리
- 소스 지갑 등록/삭제
- follower 지갑 생성/연결
- 페어별 예산/상태/활성화 토글

### 4.2 신호 감지
- 소스 지갑 거래 발생 시 이벤트 캡처
- 동일 tx 중복 처리 방지(idempotency key)
- 지연 및 누락 모니터링

### 4.3 주문 실행
- 시장/아웃컴/방향 매핑 후 follower 주문 생성
- `min_order_size` 미달이면 보정 후 주문
- 슬리피지 3% 초과 예상 시 주문 차단
- 주문 성공/실패 사유 저장

### 4.4 리스크 가드
- 연속 실패 3회 시 페어 자동 중지
- 가스 0.5 MATIC 이하 시 알림
- 잔고 부족 시 자동 중지 + 알림
- RPC 오류 임계치 초과 시 자동 중지 + 알림

### 4.5 알림
- 텔레그램: 주문 실행/실패/중지/가스부족/손실 사유 알림
- 이벤트 단위 로그 링크(트랜잭션 hash) 포함

### 4.6 Web UI
- 페어 목록/상태(활성, 중지, 오류)
- 지갑별 누적 손익(PnL), 승률, 최근 체결 내역
- 알림/오류 타임라인

## 5. 데이터 모델(초안)
- `source_wallets`
- `follower_wallets`
- `wallet_pairs`
- `trade_signals`
- `mirror_orders`
- `executions`
- `risk_events`
- `balances`
- `alerts`

## 6. 보안 요구사항
- 니모닉 평문 저장 금지
- 다수 지갑 대응 가능한 암호화 vault 저장소 사용
- 권장: 로컬 암호화 DB + 마스터 패스프레이즈
- 로그/알림에 민감정보(니모닉/개인키) 출력 금지

## 7. 성공 기준
- 신호 감지 p95 지연이 운영 허용치 이내
- 중복 주문률 0에 근접
- 실패 원인 분류 가능(슬리피지/잔고/RPC/min_order_size 등)
- Web UI에서 페어별 손익 추적 가능

## 8. MVP 단계 계획
### Phase 1
- 소스 3개 페어로 라이브 운영
- 자동 실행 + 리스크 가드 + 텔레그램 알림

### Phase 2
- 20~50 페어로 확장
- 실행 안정화 및 운영 대시보드 고도화

## 9. 오픈 이슈
- `RPC 오류 연속` 임계값 숫자 확정 필요
- 잔고 부족 판단 기준(USDC/MATIC 분리 임계값) 확정 필요
- PnL 계산 기준(실현/미실현 포함 여부) 확정 필요
